RDS is the service that provide a way to integrate the Relation Databse.


  
Lets create a RDS instance with SQLServer :-
  
  AWS Console > RDS > Create DB  
  Engine options: Select which kind of DB and its version you wants to select from list #SDB
  DB instance identifier: A unique id that must be unique among all DB instance that are in your AWS account 'mufdatabaseinstance'
  Master username/Password: A user who will defining  users, objects, and permissions in the databases
  DB instance size: Chosse the proper one depending on computational poewer you need.
  Storage Type: 
    General Purpose (SSD) -> suitable for a broad range of database workloads. Provides baseline of 3 IOPS/GiB and ability to burst to 3,000 IOPS.
    Provisioned IOPS (SSD) -> suitable for I/O-intensive database workloads. Provides flexibility to provision I/O ranging from 1,000 to 30,000 IOPS.
  Storage autoscalingInfo: let it be default ??????
  Availability & durability: AWS keep the stadby replica of DB in cas of emergency.
  Now just press 'Creat Database' leave all other default. and u r done
  
  You have created the DB now.
  Lets now connect it with other things
  
  As like the any 
  linux machine connect     at SSH port 22
  window machine connect    at RDP port 3892
  MySql Databse  connect    at TCP port 3306
  
  So to let it connect with outside word we need to open the 3306 port of this RDS DB instance
  How  
  open the DB page by clicking 'mufdatabaseinstance' and click on vlaue of 'VPC security groups'
  VPC Security group: 
    This is simply a firwall around our DB. This firwall should leave the proper port (3306 for mysql) open for client
    (This client could be a IP, CIDR or security group)
    How a security group can also be a point of connction for other security group 
    Still A question ?????
    But for now lets open the TCP 3306 port to all so that anybody can connect our sql DB
  DB connection string:
    Note the VPC url from  RDS > 'mufdatabaseinstance' > DB url
    It formate is : 'mufdatabaseinstance.cu3kxg4kbwag.ap-south-1.rds.amazonaws.com'
    Also keep the note of root user you created at the time DB creation (rootUsername, rootPassword)
  
    
  How to connect with MySql workbench in you PC
  will see later ????
  How to connect with EC2-webserver instance.
  For this we first launch the EC2 instance and make it a webserver
  How? We have already seen it
  So create EC2 web server, select proper security group as such EC2 have HTTP-80 and TCP-22 open
  ##VVIMP: Why not TCP-3306: Because this  EC2 is not a databese itself, it will make a connection with DB at the port-3306 of DB
  
 ----------------------                           
                          ------HTTP--------                        
    world wide web        ------HTTP--------            80-----
                          ------HTTP--------                  |                                
 -----------------------                                      EC2-----------------  3306   RDS - MySql
                                                              |
 muf------------------SSH--------------------                 |
 fat------------------SSH--------------------           22-----
 mur------------------SSH--------------------
 
 The web-server created with EC2 may be built with any software like apache etc.
 We will place either our java(war file), php, nodejs code in proper directory (var/www/html) 
 
 To connect the DB at amazon RDS we will write simillar kind od code 
  phpDBLib.connect('DB connection string', '3306', rootUsername, rootPassword)
  OR
  javaDBLib.connect('DB connection string', '3306',rootUsername, rootPassword)
  OR
  etc.
 
  
  
  -------------
  
  Choosing VPC, subnet group, Publicly accessible at a time of DB creation
  
  VPC:  This is solely depend on you.
  Subnet group :- 
      Why subnet group important
      impact of public subnet group
      impact of private subnet group
Publicly accessible:-
      This one will decide if a public UPv4 should be assign to this DB or not
      If yes, then a public UP will be assigned and so anybody from outside internet can reach to this DB via SSH or any
      if no then no public IPv4 will be assigned and so the DB will be acceesible only in the subnet its been created. 
      

    
    
 ----------------
 EC2 and RDS relative location in VPC :-
  If EC2 and RDS both are liying in same VPC, then there is chances that 
  1. Affect of RDS publicaly accessible
      > It has no effect, Doesnt matter id RDS is publically accesible or not (means RDS has an public IPv4)
        If other things are right then the EC2 will be able to connect and communicate.
  2. Affect of RDS living in public or private subnet :-
      > It also has no effect, Doesnt matter if living in public or private subnet
          If other things are right then the EC2 will be able to connect and communicate. becaue the public/private subnet decide
          weather the internet traffic generated from outside VPC will be able to reach to component living inside subnets or not.
          If both the part EC2 and RDS are inside the same VPC then subnet doesnt matter.
  3. Affect of EC2 living in public or private subnet :-
    ?????????????
    I think thi also shouldnt have any affect, because both live inside same VPC.
  4. Affect od security group of EC2 :-
      This do has a effect.
      It must allow the outbound TCP traffic at proper port
        eg. for mysql 3306, for postgress ***
 5. Affect of SG of RDS
      It also do have effect
      It must allow the SG of EC2 to connect at at proper port in inbound rule (eg. for mysql 3306, for postgress ***) 
      [
        Note: will simply seting up the inbound rule wiht port and 'any IP' work ?
        No!, This is useful when we are connecting the RDS from outsde the VPC, like when we connect the RDS from local machine from home or office.
        or we wants to connect from webserver outside the AWS ecosystem.
      ]
      
      
     --------
     Scenario when webserver is outside the VPC -
     ??????
      
        
        
        
 ---------------------------
 
 DB Engine and version-
  There is 6 RDB supported
  SQLSever
  ORACLE
  MySql
  PostgresSql
  Amazon Aurora : amazon itself
  MariaDb
  
  IMP: there are diffrent version of that DB also there. like in Oracle you may have enterprise and standard edition etc.
  Some of them may not be in free tier.
  
  Use Case:- 
    There are 2 use case 
    -Prod: This has some default onfiguration like Multi EZ enbaled and higher speed low letencty profile. 
    -Dev/Test: This has single AZ with low storage and lower speed.
      This is ust an default value set up, you can change them any time.
      
  DB Instance Class:-
  This define the quality and auantity of compute power
    This define what king of EC2 CPU you wants for this DB. 
    There is 3 family of class
      1.  T2 / T3
          1 - 8 vCPU
          1 - 32 GB RAM
          Moderate Networking performance
          >> Great for small and variable workload
      2.  M3 / M4
          2 - 64 vCPU
          8 - 256GB RAM
          High Networking performance
          >> Great for CPU intensive work
      3.  R3 / R4
          2 - 64 vCPU
          16 - 488GB RAM
          High Networking performance
          >> Great query intesnsive work and higher connection workload.
                 
    Miti AZ:-
      If you enable this then, you will have two diffrent DB instance under the hood. one is primary and 
      other is secondry and copy of primary. AWS take care to keep the secondry in synch to primary.
      In case of any failover the secondery will becom the primary.
      When you choose the Multi AZ then, you can see the subnet group in connectivity detail od DBs aws page.
      In Multi AZ env there is two DB host, The primary and secondry.
      Primary handle all the traffic and answer it. For any write operation the wrote forst happen over prime one
      and then on sec one. after write on prime and sec both are successful, the user will be acknolaged with success
      otherwise with failure.
      IMP: The Multi AZ not at improve a bit of your performance. It do not handle any traffic. 
      Its only is to keep a secondry one ready in case of failover at primary one.
      On the contrary it actully increase the time for write operation on DB. bcoz now write has to perform on two 
      diffrent isolate host
      cost is also high.
      It give one additional advantage at back uo time, noe 
      taken from secondry not primary.
      Multi AZ and DNS :-
        In the Multi AZ DB the DNS play a major role, when the prime DB fails then its duty of DNS to resolve the 
        DNS name to proper working DB instance either prime or sec.
        Lets say you have a Multi AZ DB (mufdatabase) with End point is 
           'mufdatabase.c1eagwg2tuyz.us-east-1.rds.amazonaws.com'                 ....DNS_name1
        the DNS_name1 is DNS name but it does not have any IPv4 address attached to it.
        instead its just an entry in AWS DNS registery syatem which is mapped wth underneath EC2 instance.
        This DNS either resolve to prime or sec DB instance depends on the scenario.        
        Lets say two DB host (prim+sec) underneath this DB instance are
          ec2-35-172-176-105.compute-1.amazonaws.com   OR   35.172.176.105        
        And 
          ???????????
        In that ase the infra would be -
                                                                                  Prime
                                      |------------------------- ec2-35-172-176-105.compute-1.amazonaws.com
                                      |                                     OR   35.172.176.105
                                      |                                              . 
                                      |                                              .
       DNS_name1  --------------------                                               .
                                                                                     .
                                                                                     .
                                                                                     .
                                                                                    Sec
                                                                  ec2-34.200.143.202-compute-1.amazonaws.com
                                                                           OR   34.200.143.202         
        
        
        In a good time the DNS_name1 will point to 'ec2-35-172-176-105.compute-1.amazonaws.com'. 
        you can test it via nslookup or host commande in ubuntu and windows.
        if you rum command 
          >> host mufdatabase.c1eagwg2tuyz.us-east-1.rds.amazonaws.com
        You will get 
        Name: ec2-35-172-176-105.compute-1.amazonaws.com
        IP:   35.172.176.105 
        Aliases: mufdatabase.c1eagwg2tuyz.us-east-1.rds.amazonaws.com
        
        the dotted vertical link between prime and sec DB in the ultra low latency connection which keep the 
        sec in synch with prime.
      What happen at Multi AZ Failover - 
        When a failover occure in prime one, The aws DNS will do neccesary changes and start pointing to sec one 
        against the DNS_name1. Now sec will start behaving like prime
        onece the failled DB instane is up again, it remain as sec and stay the up to date with prime one.
        Now the infra would be -
                                                                                            
                                                                                    sec
                                                               ec2-35-172-176-105.compute-1.amazonaws.com
                                                                           OR   35.172.176.105
                                                                                    . 
                                                                                    .
       DNS_name1  --------------------                                              .
                                      |                                             .
                                      |                                             .
                                      |                                             .
                                      |                                            Prime
                                      |------------------------ ec2-34-200-143-202.compute-1.amazonaws.com
                                                                           OR   34.200.143.202         
        
        
        

     Now if you rum command 
          >> host mufdatabase.c1eagwg2tuyz.us-east-1.rds.amazonaws.com
        You will get 
        Name: ec2-34-200-143-202.compute-1.amazonaws.com
        IP:   34.200.143.202
        Aliases: mufdatabase.c1eagwg2tuyz.us-east-1.rds.amazonaws.com
      
      
    IPs of Multi AZ RDS:- For the DNS name of RDS endpoint(DNS_Name1) there is no IP, instead DNS_Name1 is nothing but an alias
    the real endpoint is actully those prime or sec Ec2 instance.
    The layer of alias (DNS_Name1) is added to build the feature od multi AZ support.
    The ailas could either point to prime or sec, depending on if failover happen or not.
    
    If you rum thi command
    >> host ec2-34-200-143-202.compute-1.amazonaws.com
    the output will be-
       Name: ec2-34-200-143-202.compute-1.amazonaws.comhas 
       IP:   34.200.143.202
    
      
    After creating a DB in RDS, The AWS only give you the DNS name for that DB to connect.
    It never ever gives you the IP address, that is of course because in case of failure of prime DB the sec DB turn inti prime and so
    the IP of DB also changed. 
    The DNS remain same and it start pointing to Sec DB
      
  
    Storage Type Allocation :-
      This define the quality and quantity of storage 
      There is 3 type-
        1. General Purpose : GP2
          SSD
          up to 16TB
          3 to 3K IOPS [input outpu per sec]
        2. Provisoned IO : IO1
          SSD
          up to 16TB
          up to 40K IOPS
          >> High performance and should be use in prod
        3. Megnetic
          for legacy
  
  
  
  
Pricing:-
    The cost of DB is decided by this factors -
      1.  DB Engine and version + its licence if applicable
      2.  DB Instance Class
      3.  Miti AZ
      4.  Storage Type Allocation 
      
      
Databse Idetifier:-
    This is an unique identifier for the databse of you AWS account.
    In any region of any AWS account, the identifier will be unique. So choose the value as such.
    This is useful for aws API to identify DB.
    IMP: This is an identifier, not the database name. 
      
Credential:-
    This is the master user cred. and have most previlaged permission. this permission though varies for diffrent DB types.
    Its very dagourous to use this ser in Application. instead create the another user after DB creation
    with less privillages.
  
Networking Config:  
    VPC:-
      You must select an VPC in which you DB will lie. 
    Subnet Group:- 
      The subnet group is the set of subnets in same VPC. This subnets must lie in diffrent AZ.
      There is two time it playa a critical role - 
        1.  At a time of DB initilization, it determine which AZ(from the AZ of subnets of selected subnet group) is healthy and use that one AZ.
            Once AZ is fixed it now allocate the private IP(out of CIDR of selected subnet from subnet group) to this RDS instance.
        2.  At a time of any failovere on any AZ, and if DB is configured as multi AZ. the back up DB will be stand up at the other 
            AZ of other subnet of selected subnet group.
        
       It good practice that you either have all the aubnet public or all the subnet private in the subnet group.
       If you need to access the database from internet then place it in all-public-subnet-group other wise place it in all-private-subnet-group.
       Though in all-private-subnet-group the traffice initiated from outside will be prohibited but traffic initiated from inside will be allowed.
      
      Publicly accessible:-
        The subnet group you choose will decide if the DB should be avialable to outside or not.
        But its not the final decision to let it connect from outside.
        There is one more thing 'Publicly accessible'
        If it is Yes then the amazon will allot an Public IPv4 for this DB
        If its is No then there wont be any public IPv4 allocated to this DB server.
        So if it is no then there is no way to connect this DB from outside (either bby SSH or by any DB client) becoz there is no IP to connect at all
        Though it has a private IP but that will be accesibile only inside the VPC.
  
        IMP: The Subnet group will decide which private IP will be assign to DB.
         The 'Publicly accessible' will decide if the public IPv4 will be assign to DB or not all. 
         if yes then an IPv4 from the aws public ip pool will be allocated. 
         
              What if in a subnet group all are private subnet
              ???
              What if in a subnet group all are public subnet
              ???
              What if in a subnet group are public + private subnet
              ???
              What if in a subnet group all are private subnet but the Publicly accessible set to be Yes?
              ???         
         
    AZ:-
        If you wnats to have the DB only in specific AZ then be my guest.
    
    Security Group:-
        The 'Subnet Group' and 'Publicly accessible' both provide some layer of security as add on.
        Like subnet group can deny accessibilty to outbound initiated internet traffic if it is all-private-subnet-group
        Like you do not even assign the public IPv4 by setting the 'Publicly accessible' to No. and provide no way to 
        connect the DB and public internet.
        But this two rae very broad level
        What if you wants it to be accessible to some system and not to other one.
        what if you wants let the traffic initiated from cetain IP to flow but deny other
        What if you wants let the DB to initiate the connection with certain IP but not with other.
        
        For this comes the Security Group:-
        In the SG ou can set the inbound and outbound rule and so make the firewall round the DB which will 
        keep the source and destination of traffic in check from both side.
    
 <--End Networking-->
    Provisioning Database:-
      In this part we define certain charachtristrics of database itsef.
      DB Name: his is the default name of the database to create. This is diffrent from DB identifier.
      DB Port: ususally default shoud be taken
      DB Param: 
      DB Option: 
      DB Encryption:
      DB Monitoring:
        
------
   Automated-back-up:-
    Here you will set two imp things
    Backup Window:-
      The time window when the back up should be taken. EG: 24 hour
    Retenstion priode:-
      How long you wants to keep the back up. EG: 35 days
     EG: Take back up after every 24 hour and keep this back up file for next 35 days.
     
     The snapshot of the back up will be shown at 
     RDS > snapshot
     you can see the type of the snapshot will be 'Automated'
     
   Restoring from back up :-
    1. for this simply select the DB > Action > restore point in time.
    2. Select time 
    3. choose DB identifier [must and should be non existubg one]
    4. chose other thing
    5. Done
    
--------

  Snapshot:-
    Other way to take the back up is via snap shot. This is totally manual process for backing up.
    to take it :-
      1. for this simply select the DB > Action > take snapshot
      2. type name
      3. save
      You will be able to see the snap in 'snapshot' page
     Restore :-
      1. got to snapshot
      2. Action > restore
      3. choose DB identifier [must and should be non existubg one]
      4. chose other thing
      5. Done

  
  Snapshot vs Automated-back-up :-
    Simillarity - 
      1. Both are way to take back up and restore
      2. Whenever  you restore the DB from snapshot or from Automated-back-up, the process is very same
         and in both the DNS endpoint get changes. you have to choose the other identifier.
         So orignal.bala.blabal.aws.com  may changed to   snappy.bla.bla.aws.com
      3. For both of them the snapshot of back up will be visible at 'snapshot' page
     Diffrence :-
      1.  in Automated-back-up the back time and retention is configured, after that taking back is totally automatic proceess
          in snapshot you take a snap whenever you need. so here backing up is not automated with time
      2. The type of snapshot will ne 'manual' for one and 'automated' for other.
      
 -----
  
  
  Maintainance:-
    Select the time and proide for this. DB will automatically down in this window.
  
    -----------
    
    DB Scalling :-
    here is 3 way to scale it, depend on what dimension you wants to scale -
    Scalling Compute :-
      You can change the DB instance class, You have option to choose when this change must apply
      either immidatly or at maintainance window.
      FOr this scalling opertation there will be an downtime.
      In Single AZ DB the downtime is large.
      IN Multi AZ its minimal, becoz the secondy on frst fail and updated, second now act as prime and then prime start updating
      Changing DB instance class is straighforward, you just have to know about its impact.
        
     
  Read Replica:-
    Suppose in your app you see at a time there is only 5 write operation but 500 read operations. So lot of read but very few write
    If you have only one DB answering all of those then there may be lot of leg.
    For this comes a read replica.
    Here you craete a additinal databases which are remain in synch with its master database.
    The write operation will happen on master db and later those changes will be synch up with other read replica.
    This feature reduced the time for reading data too much.
    Though the read replica could remain few minute behind of master data. So developer has to be careful
    it may be possible that data written on master may not be available immidiety on read replica
    
    Actully read replica in itslef a complete standalone DB instance execpt it is remain sych with master.
    In your app, you can connect with master or replica DB. both have their diffrent endpoint.
    But you should use master for write and replica for read.
    
    IMP Notes : 
    - All read replica have diffrent DNS endpoint, so in theory they are completely diffrent and independent DB.
    - You can have a RR of RR DB [but letecy will be low]
    - 
    
    You can create read replica in diffrent region.
    
    Read Replica vs Multi AZ :-
      In multi AZ, the prime and sec has 0 leg. data written on prime will also reflect on sec and then operation suppose to be completed.
      In read replica, the write happen on master and operaton marker as done. after some time those changes will be transmitted to all read replicas.
    
    How-
      1. Aws > RDS > instance > check 'mufdb' > modify > create Read Replica 
      2. now set all values, this is just like creating a new standalone DB actully, name it say 'muf_1_DbReplica'
      3. Done
      
      Now in the app you should do write operation on endpoint of 'mufdb' and for read you can use any of 'muf_#_DbReplica'.
      
      for good prformance one should create multiple readreplica in diffrent AZ to keep.
      
    ------
    
    Read Replica VS Multi AZ:
    AZ is for disaster recovery only, and for mainainace time backup.
    Read replica is for performance boost
    Read replica is asynchronus [one after other]
    AZ is synchronus [in paralel]
    
    ----------
    
    Encryption :- 
      You can sekect if you wants to eencrypt the DB or not. if yes you also must select the key for AWS KMS [key management syatem]
      once done the RDS take care of rest pof the things.
      
      
      snap shot, Automated back up :-
        If source DB is not encrypted :-
          Then restored one will also be remain un-encrypted and cannot be changed to encrypted.
        If source DB is encrypted :-  
           Then restored one will also be remain encrypted and cannot be changed to un-encrypted
    
    Read-Replica :-
        If source DB is not encrypted :-
          Then replica can be encrypted or unencrypted. Its users choice
        If source DB is encrypted :-  
          Then will always be encrypted! user cannot change it.
      
      
    
    
    Encrypt the pre-existing un-encrypted DB :-
      Currently not supported buth there is a trick
        ?????????
    
    
    ------_----
    RDS and ElastiCache
    ??????????????????????????
    
    
    
    

  
