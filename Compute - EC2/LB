
A lod balancer simply route the application request or network traffic to the diffrent targests like EC2 instances, containers, and IP addresses, in multiple Availability Zones


<<<More theory needed>>>>

AWS provide three king of LB :-
  1. Application LB : for general purpos HTTP/HTTPS LB
  2. Network LB : for ultra efficient and have performance of million request per sec
  3. Classic LB: previous gener
  
  <<Detail diffrence come later>>


Creating A LB for EC2-webserver:-
  1. Take care that proper region is chossen.
  2. EC2 -> Load Balancer -> Create [Application LB] 
  3. Now slecet name 
  4. choose schema: internet facing
  5. Listener:-
      keep the HTTP port 80 open for allowing in the internet traffic
  6. VPC/SubnetId/Availability Zones :-
      Here you have to select the VPC and then the subnet in that VPC.
      The LB will route the traffic to EC2 lying in that subnets only.
      Therts is some rule to choose subnet
        - You have to choose at least two subnet
        - both the subnet must lie in diffrent AZ.
      
      
  7. Security Group:
    A SCG which has inbound port open. this port could be 80, 3000, 8080 etc. 
    default is 80 but if your app in subodinate EC2 may ran on diffrent port so you may wants ti tobe like 80, 8080, 3000
    EG: 
    HTTP   80     0.0.0.0/0, ::/0  or 
    HTTP   8080   0.0.0.0/0, ::/0  or
    HTTP   3000   0.0.0.0/0, ::/0

  8. Routing/Target Group: 
    The routing group inform the load balancer that to 
      whome (To EC@ or Lembda) he should navigate the traffic and 
      how (Via HTTP:3000 or HTTP:80 or SSH:22)
    Slect or create the routing group of you choice
    How to create
      8.1  select routing group name 'MufWebServerRoutingGroup'
      8.2  Target Type: instance.  
                Becauase we wants to route the traffic to th EC2 instances
      8.3  port and protocol 
                This inform the EC2 that how he should connevt the EC2s, 
                you need to specify the protocol and port.
                generally its HTTP and port 80.
                But many app (specially Node app) may ran at diffrent port so it could be 80, 8080, 3000 etc.
      8.4 Health Chech ?????
      8.5 Register Target:
          8.5.1 Here you will register the targest for LB ports chosen in step 8.3
                This targets are instances of running EC2s, you can select multiple of them here.
  9 press Create and you are done   
 
 
 Now later if you wants to add or remove any Ec2 instance again then-
  EC2 ->  Load Balancing -> Target Group 
  Choose the one you created in step 9, and add remove target as in step 8.5.1
  
  
  
  
   ----------------------                           
                          ------HTTP--------      --|            |--     ---HTTP--- 80 - EC2 1  
    world wide web        ------HTTP--------      --- 80 - LB-------     ---HTTP--- 80 - EC2 2
                          ------HTTP--------      --|            |--     ---HTTP--- 80 - EC2 3                               
 -----------------------                                      

 
Q: If we are ok to use only one EC2 instance for webserver then can we ignore use of LB completly
A: No! Not at all.
    Because EC2 instance is something that could be carsshed/stop/terminat. And if next time 
    you again start a new instance then it will have a new public IP. And if he got a new public ip
    then webserver will be pointed out to diffrent location
    SO LB save you from this uncertainity. and even if EC2 went down and we start new EC@, we can simply
    place this new EC2 behid the existing LB. and so your endpint remain same.
    
Its always an good idea that you create a EC@ instances in diffrent AZ, Create LB capable to connect with those AZ for fault tolenrence    
    

-
In above discussion i assume that we used apache server at port 80, but this is chengable so if i am using Nde server at 3000 like below
                              http.createServer(function (req, res) {
                                res.write('Hello World! version 1'); 
                                res.end(); 
                              }).listen(3000);
Then i have to user 3000 in place of 80 everywhere.

----------

LB and HTTP Header
https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/x-forwarded-headers.html

Network LB???????????


-----------

  LB and EC2-NodeJS server:-
    This is 100% same as above with minore cahnge,
    say your nodejs server is running at port 3000 then you select port 3000 instead of 80 everywhere.
    So if instaed of port 80 app is running at port 3000 then below things should be changes-
    1. Security Group: 
        ins step 7 you set
        HTTP   3000   0.0.0.0/0, ::/0
    2. Routing/Target Group: 
        in step 8.3
          it should be HTTP:3000
    
    
    I
  if you have user the port 80 then you do not have to give the port because HTTP has it default but if you setuo at t port 30000 then use
        mynodelb-585968286.us-east-1.elb.amazonaws.com:3000
  
_-----------------

LB and ENI: just like an ec2 the networking unit of LB is ENI.
The SG of LB is also attached to that ENI.
the LB always need at least two subnet each in diffrent AZ.
and ENI lies in a sinlgle subnet so LB will always have at least two ENI attached.
if LB can span to n number of AZ then it must at least have n number of ENI.
also each ENI will have an public ip attached to it.
  
LB Health Check ???????????/
 
 
---------------------------

LB and EIP:-
  LB do not have any EIP or public IP. the ELB is reaccable by its own DNS name lookup that is '<elb name>.us-east-1.elb.amazonaws.com '

LB and ENI:-
  LB do has the private IP and assosiated ENI in each of selected subnet.

--------------------------------

Sticky Session:-
  Sticky session foe LB is used when you want a session on any user to handled by a specific EC2.
  Only classic LB support it properly. if you enable thhen all the request in particular user session will be deliver to one specific EC2.
  
  ALB also support ot but the request will be deliver to one of the ECw in specific Target group,
  
  
--------------------

LB - Traget - AZ relations:-
  When you create the LB you first select the AZ where the LB will work. in background AWS place an ENI in each AZ you selected.
  It may be possiblr that target group spread over az1, az2, az3 and az4. But LB is attached in az1 and az2 only.
  in that case even though target group has instances running in az3 and az4 and LB has this target group listening still LB will 
  not be able to route any traffic to instances in az3, az4.
  ALB route traffic equally in all the AZ and after that this traffic is distributed in targets.
  
Cross-region load balancing:-
  As you know LB sent thetraffic to multiple AZ. and TG is spread oer many AZ.
  When LB sent the traffic to AZ and then to TG. it may be possible some AZ has more instances then other.
  EG:-
    say AZ1 has 8 EC2 of TG1
    and AZ2 has 2 EC2 of TG2
    The LB will send 50% traffic to AZ1 and 50% to AZ2. so 8 EC2 of AZ1 will have 50/8 = 6.25% and 2 EC2 of AZ2 has 50/2 = 25% traffic.
    to resolve this comes the cross-region balancing.
    if its enable then ALB will send 100/10 = 10% traffic to each EC2 across the both AZ. 
    Actully in the background LB-node [ENI of LB in AZ2] in AZ2 send prpotional traffic to AZ1
  For ALB this enable by default. for other two you have to enable it.
  
-------------------------------


LB and Health Check:-
  YOu need to configure the Health check for each Target Group and this healthc check has
  Port, Protocol and path.
  LB keep sending the signals to the targets in that groups in each HealthCheckIntervalSeconds  interval.
  If the health checks exceed UnhealthyThresholdCount consecutive failures, the load balancer takes the target out of service. 
  But LB do not just deregister it instead it keep sending signal and 
  When the health checks exceed HealthyThresholdCount consecutive successes, the load balancer puts the target back in service.
 There is 4 possible stage of a target
 1. Initial
 2. Healthy
 3. Unhealthy
 4. Unused:
      The target is not registered with a target group either 
      - the target is in an Availability Zone that is not enabled, 
      - or the target is in the stopped or terminated state.
  
---------------------------------------
  LB Target group of LAmbda:-
    It is also possible that to have a Target group whise traget are lambda. LB will invoke tha lambda on that requests
  





