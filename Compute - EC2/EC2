What is rackspace


Why EC2: because purchasing a server and maintaining them is a hell.
          Now with EC2 you buy a machine and ready to go.
 
    
Type of Ec2 instances-
  There are couple of EC2 instances which are design to achive a specific goal
  EG
    T3    Low Cost-Genral purpose     web server/small DB
    G3    Graphics intensive          video
    I3    High speed storage          NoSql, DBs
    R5    Memory optimized            Memory intensive
    M5    General Purpose             App Server
    ...
    ...
    
Subtype of instances:-
   Each above type of instance is design to support and handle specific type of requirment. Like one is best for
   DB and other is optimized for game. 
   After selecting a type nest thing is how intensive you wants to use your system.
   EG: you say i need a DB optimized Or web-server optimized instance, But how intensive your workload going to be.
   Depending on this you select the subcategory.
   
   Lets say i wants a general purpose T3 instance.
   Now    if my workload is moderate then i will go for t3.small
          if my workload is significant then i will go for t3.large
          if my workload is bulky then i will go for t3.xlarge
   Whats diffrence in between this instances :-
          diffrence comes in Memory-size (RAM not EBS), vCPU count, Storage type (EBS or other).
      
  
  >> Type and SubType is two most fundamental decesion you must take before selecting an instance.
  
  Setting instance configuration:-
   Once you decided waht type and subtype you wants, next comes the configuration
   This are the peramter you set before launcing, Some example are
   1. No of instances
   2. Autoscalling
   3. spot price config if needed
   4. network and VPC ???
   5. subnet: decide in which AZ the instance will lie
   6. assign public IP: aws has a pool of public IP avialable to use. If you need one then it will be assign to your EC2.
                        With Public IP you can access the Ec2 instance over public internet
   7. Capacity reservation if needed
   .....etc.
   


The next IMP thing comes in EC2 is Hard Disk Drive, You need to devide how much storage you need for any EC2 instance
The storage in EC2 is EBS    
    EBS:-
    As like any normal PC/Server the virtual PC/Server also need a hard disk, EBS play this role
    EBS is virtual Hard Disk Drive of you EC2 instance.
    You can use this drive to 
      install OS, mounting File System, DB etc.
    Type of EBS :-
      1. SSD
          1.1 GP2
          1.2 IO1
       2. Megnetic
          2.1  ST1
          2.2  SC1

Security Of EC2 instance:-
    This is most critical part of EC2, Security of EC2 is implemented via Security group attached to EC2 
    Security group is nothing but a kind of firewall around EC2, that decide who can communicate to EC2 and who cannnot.


EC2 and Other AWS services -> 
    EC2 can perform operation over diffrent aws service (E.G S3, cloudfront etc)
    But before performing the operation the EC2 instance should have proper autorization
    There is two way to Authorize the EC2-instance for other AWS operation
    1. By loging in to AWS-CLI in EC2 instance with authorized user of AWS account, For this you must have a authorized user
    2. By assigning the role itself to EC2 instance. (No IAM user required)
    
    #AUTHEC2_WAY_1
    Way 1: 
          1. Strat EC2 instance
          2. Create user with proper permission to access and manage S3 
          3. From SSH-terminal connect local pc ('muf') with EC2 ('bar') via proper private key
          4. One you are in terminal of EC2 (Not you local PC)
                    at   ec-user@1.1.1.1 >_
                    not  MufazzalPC: >_
             do the login to aws-cli via command 'aws configuration' with proper access key and ID of user created in step 2
             
          under the hood: 
                    the command 'aws configuration' create a config file i EC2 instance at path '?????'
          Security flaw in here :-
                    The EC2 instance actully save the access key and ID at './aws' directory of EC2 honme drive
                    So sombody may be able to see it if he has access to EC2 via SSH. So second aproach is recommended.
                    Also if your key is compromisesd and you change it. then you have to login in all Ec2 instances manulally
                    and change them via 'aws comfiguration'. 
                    
         
    #AUTHEC2_WAY_2
    Way 2:
          1. Crate a Role in IAM (for EC2) with proper permissions [seAdminFullAccess in our case]
          2. right click on EC2 > action > instance setting > add/remove Role
          - You can attach or dettach the Role   from EC2,  and it      will take immediate effect. you dont even have to restart the Ec2
          - You can attach or dettach the Policy from Role, and it also will take immediate effect. you dont even have to restart the Ec2
           
    VVVINMP : in way 2 the it is very IMP to remember that the aws configuration file will not be created at the path '??????'.
              so in the code if you have used 'new AWS.SharedIniFileCredentials({profile: <profile>});' 
              The code will fail for sure.
      
           
    Lets say you wants to create a S3 bucket wirh EC2
       For this Once login is successful, You can use the comands to create S3 bucket at location '  ec-user@1.1.1.1 >_ '
                    >  'aws s3 mb s3://muf12decbuck'

    ------------------
    
Using EC2 As Apache Web Server :-
	Till now we have seen that how we can configure the EC2 instance to listen the SSH traffic on Port 22, We see hoe we create the 
	Security group with inbound rule of (SSH-22-0.0.0.0) setup.
	Now when we wants to creat a Apache webserver also out of this EC2, The first thing we need to do is to 
	let the HTTP traffic to be listened at port 80 so first step to create a web server is to creat a security group with 
	inboud : 
						SSH  22   0.0.0.0/0   -> because you may also need it to access by SSH
						HTTP 80   0.0.0.0/0

	nest thing you require to use EC2 as web server 
	1. A proper webserver to be installed like Apache, websphere etc.
	2. A proper war or html deplo on it    

	Lets create one vert tiny web server from EC2 :-
	create EC2 with proper security group 
	Connect to EC2 by SSH
	> yum update : to update ec2 libs
	> yum install httpd -y : install the appache server
	> service httpd start : strat the servert
	> cd /var/www/html : go to the server directory which will be visible to internet
	> Create a file 'index.html' [how> CLI.txt #CreatFile]
	> DONE : go to the IP of EC2. EG : http://15.206.125.146/ or http://15.206.125.146/muf.html

	Selecting source as another Security Group:-
				Instead of the CIDR block you can also select another security group as source.
				EG: say a EC2-muf has SG as
					SSH  22     sg-1
				This will allow all the EC2 whos securyty group is 'sg-1' will be able to establish connection with EC2-muf. 


	Ec2 and Nodejs web server:-
				When you use the EC2 for NodeJs webserver you may use diffrent port then 80 EG.
													http.createServer(function (req, res) {
														res.write('Hello World! version 1'); 
														res.end(); 
													}).listen(3000);
			So here in SG instead of opening 80 you should open 3000 
								SSH  22     0.0.0.0/0   -> because you may also need it to access by SSH
								HTTP 3000   0.0.0.0/0
    
    ----
    
    EC2 Bootstap script : 
          https://acloud.guru/course/aws-certified-cloud-practitioner/learn/Cloud-Concepts-And-Technology/lets-use-a-load-balancer/watch?backUrl=~2Fcourses&backUrl=~2Fcourses
          at 5:52
     
     
    ----------
    
    EC2 - web server install wordpress script : 
          #!/bin/bash
          yum install httpd php php-mysql -y
          cd /var/www/html
          wget https://wordpress.org/wordpress-5.1.1.tar.gz
          tar -xzf wordpress-5.1.1.tar.gz
          cp -r wordpress/* /var/www/html/
          rm -rf wordpress
          rm -rf wordpress-5.1.1.tar.gz
          chmod -R 755 wp-content
          chown -R apache:apache wp-content
          service httpd start
          chkconfig httpd on

                   
 -------------------


User Data:
	In the user data you can provide the script that can ran at the initilization of the EC2 insyance.
	This script run only at once. never rerun again even if you reboot the instance.

	You can provide it like this
			#!/bin/bash
			yum update -y
			yum install -y httpd 
			...
			...
	 The first line tell the AWS to run this script on EC2 with bash
	 -y: in the mid of running any command in script it may be possible that user would be asked to enter somthiy 
			like'press Y to continue'. fir this proide the answer in advance.
	 This script run with root user so no need for 'sudo su' 
	 The ouput log can be sen at 'var/log/cloud-init-output.log'

	Changing User Data after creation of instance:-
		You can changeit but first you have to stop the instance and then simpllty cahnge it via colsole or CLI.
		You cannot change the user data of running instance.
	
	Remeber two imp thing when writing user data script
	1. It run as root user not as ec2-user. so you have max privilages and no need to do 'sudo su'
	2. the directory it run is 'root/' not in 'home/ec2-user/'
------------		
	installing Node-js on EC2 -
		https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/setting-up-node-on-ec2-instance.html

--------------------

RElation of Region of EC2-Coumpute unit and other logical or physical peripheral like EBS, EFS, SG, ENI.
SAME mns that both the EC2 compute unit and the object(EBS, EFS, SG, ENI) must lies in same subject(AZ, Region, Subnet, VPC) 

					AZ		Region			Subnet			VPC
EBS				SAME	SAME				-						-
EFS
SG				-			-						-						SAME
ENI				-			-						SAME				SAME

---------

EC2 Hibernate:-
	The EC2 hibernate provide fater alternative to start and stop the instances.
	When you stop the instance then the instance RAM is evoparated and OS is lost. so when you start it again then the EC2 has to 
	first load the OS then
	run the user data script and then
	run the applications again if needed.
	And all this takes time. 
	But if you hibernate the EC2 then the RAM conent is not loast instead it copied in the attached Root EBS and when its started back from Hibernation then 
	the conent preserved from RAM is loaded again from EBS. and so none of the process need to be re-done.
	To make EC2 hibernate compatible you have to have large EBS volume attach to accomodate RAM content and also you must enable it at a time of instance creation.
	
	By default EC2 do not enable Hibernation function. It must ne enable at a time of launch. 
	To put EC2 in hibenation:-
		Ec2 > your inst > state > Hibernate

        Charges when ec2 in the Hibernate;
           This is where u save money. u will be charged for EBS volume and Elastic ip (if attached).
           u will not have to pay for EC2 itself.
-----------------

EC2 Placement Group:-
	The EC2 ran in the data centers and are a nothing but a hardware devices stack in the AWS  dat centers.
	The AWS provide so detailed functionality that you can configure how and whhere in the stacks the your EC2 shoud instantiate.
	By default EC2 service places the instances in any single AZ in such a manner that they are well diversified wrt underline hardware. 
	but you can change this behaviour to met your requirment
	You can create a PG and place the EC2 instances in it.  This PG can have one of below 3 placement stratagy
	1. Clustered Placement Group:-
			- EC2s are placed very close to each other. So close that they are being placed in same stacks and share the same hardware.
				As they are in same hardware cluster, they have very less network latency when communicating with each other.
				This is useful when you need high and fast EC2-to-EC2 communication. EG. HPC apps.
				The EC2s in such kind of PG remain in single AZ.
	2. Partition Placement Group:-
			-	EC2 are placed in such a manner that they do not share the common hardware and so remain very much isolated (in term of hardware) from each other.
				This is useful when you need highly distrubuted system with good fault tolerance so that failling on one hardware do not impact other.
				The EC2s in such kind of PG can lie in in single AZ or multiple AZ.
	3. Spread:-
			- This in between Clustered and Partition Placement Group
				Here the CLUSTER of some EC2-instances are placed in isolated PARTITION of hardware. So that failing of one clusted do not impact other partitions.

	You can place the instances in placement group at a time of creating instances or after creation.
	Once instance is created then also it can be
		- Move to a placement group
		- Move from one placement group to another
		- Remove from a placement group

----------------------

EC2 CURL for meta-data and user-data:-
	A unique feature of EC2 is inside the EC2 you can do the curl to get couple of imp info of the same EC2.
	How:-
		First SSH into the EC2 instance
		now curl here
			curl http://169.254.169.254/latest/meta-data/<item_name>
		item_name could ne 
			hostname, local-ipv4, public-ip etc.
		In output you will get the respective item.
		
		To get the user dat just use 
			curl http://169.254.169.254/latest/user-data


	
	
	




